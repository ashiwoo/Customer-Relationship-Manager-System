<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Reports Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background-color: #f4f7fc;
    }
    .card {
      border-radius: 12px;
      box-shadow: 0px 4px 10px rgba(0,0,0,0.1);
    }
    .employee-card {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 12px 15px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #fff;
      transition: 0.3s ease;
    }
    .employee-card:hover {
      background: #e9f3ff;
    }
  </style>
</head>
<body>
  <div class="container mt-4">
    <h2 class="text-center mb-4">üìä CRM Reports</h2>
    
    <!-- Summary Cards -->
    <div class="row text-center">
      <div class="col-md-3 mb-3">
        <div class="card p-3 bg-primary text-white">
          <h5>Total Cases</h5>
          <h3 id="totalCases">0</h3>
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <div class="card p-3 bg-success text-white">
          <h5>Completed</h5>
          <h3 id="completedCases">0</h3>
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <div class="card p-3 bg-warning text-white">
          <h5>Pending</h5>
          <h3 id="pendingCases">0</h3>
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <div class="card p-3 bg-info text-white">
          <h5>Total Employees</h5>
          <h3 id="totalEmployees">0</h3>
        </div>
      </div>
    </div>

    <!-- Chart -->
    <div class="card mt-4 p-4 shadow">
      <h4 class="mb-3 text-center">Cases Assigned per Employee</h4>
      <canvas id="employeeChart" height="100"></canvas>
    </div>

    <!-- Employee List -->
    <div class="card mt-4 p-4 shadow">
      <h4 class="mb-3 text-center">üë®‚Äçüíº Employee Wise Details</h4>
      <div id="employeeList"></div>
    </div>
  </div>

  <script>
    async function loadReports() {
      const res = await fetch("clientpilot.infinityfreeapp.com/backend/reports/api/reports.php");
      const data = await res.json();

      if (data.success) {
        // Summary cards
        document.getElementById("totalCases").textContent = data.data.total_cases;
        document.getElementById("completedCases").textContent = data.data.completed_cases;
        document.getElementById("pendingCases").textContent = data.data.pending_cases;
        document.getElementById("totalEmployees").textContent = data.data.total_employees;

        // Chart Data
        const names = data.data.employee_stats.map(e => e.name);
        const counts = data.data.employee_stats.map(e => e.total_assigned);

        new Chart(document.getElementById("employeeChart"), {
          type: "bar",
          data: {
            labels: names,
            datasets: [{
              label: "Cases Assigned",
              data: counts,
              backgroundColor: "rgba(54, 162, 235, 0.7)"
            }]
          },
          options: { responsive: true }
        });

        // Employee list with "View Details"
        const listContainer = document.getElementById("employeeList");
        listContainer.innerHTML = data.data.employee_stats.map((emp, index) => `
          <div class="employee-card">
            <div>
              <strong>${index + 1}. ${emp.name}</strong><br>
              <small>Assigned Cases: ${emp.total_assigned}</small>
            </div>
            <button class="btn btn-sm btn-outline-primary" onclick="viewEmployeeCases(${emp.id})">
              View Details
            </button>
          </div>
        `).join('');
      } else {
        alert("Error loading reports");
      }
    }

    function viewEmployeeCases(employeeId) {
      window.location.href = `view_employee_cases.html?employee_id=${employeeId}`;
    }

    loadReports();
  </script>
</body>
</html>
